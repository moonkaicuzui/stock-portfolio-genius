<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ì¬ê°€ì¹˜ ê³„ì‚°ê¸° - ì£¼ì‹ í¬íŠ¸í´ë¦¬ì˜¤ ì§€ë‹ˆì–´ìŠ¤</title>
    <meta name="theme-color" content="#4ade80">
    <link rel="manifest" href="manifest.json">
    <script src="badges.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }

        header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .nav-links a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .nav-links a:hover, .nav-links a.active {
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .page-subtitle {
            color: rgba(255, 255, 255, 0.6);
            font-size: 1.1rem;
        }

        .calculator-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .calc-tab {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px 25px;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            min-width: 140px;
        }

        .calc-tab:hover {
            background: rgba(74, 222, 128, 0.1);
            border-color: rgba(74, 222, 128, 0.5);
        }

        .calc-tab.active {
            background: rgba(74, 222, 128, 0.2);
            border-color: #4ade80;
        }

        .calc-tab-icon {
            font-size: 1.5rem;
        }

        .calc-tab-name {
            font-weight: bold;
            font-size: 0.9rem;
        }

        .calc-tab-author {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .calculator-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 900px) {
            .calculator-container {
                grid-template-columns: 1fr;
            }
        }

        .calc-panel {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .input-label .hint {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            display: block;
            margin-top: 3px;
        }

        .input-field {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .input-field:focus {
            outline: none;
            border-color: #4ade80;
            background: rgba(74, 222, 128, 0.1);
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .calculate-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #4ade80, #22c55e);
            border: none;
            border-radius: 12px;
            color: #000;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(74, 222, 128, 0.3);
        }

        .result-panel {
            background: rgba(74, 222, 128, 0.1);
            border: 2px solid rgba(74, 222, 128, 0.3);
            border-radius: 16px;
            padding: 25px;
        }

        .result-title {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 10px;
        }

        .result-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4ade80;
            margin-bottom: 15px;
        }

        .result-comparison {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .comparison-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px 20px;
            border-radius: 10px;
            flex: 1;
            min-width: 120px;
        }

        .comparison-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .comparison-value {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .comparison-value.undervalued {
            color: #4ade80;
        }

        .comparison-value.overvalued {
            color: #ef4444;
        }

        .comparison-value.fair {
            color: #facc15;
        }

        .formula-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .formula-title {
            font-size: 0.9rem;
            color: #4ade80;
            margin-bottom: 10px;
        }

        .formula-text {
            font-family: 'Courier New', monospace;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .info-card h4 {
            color: #4ade80;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .info-card p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .hidden {
            display: none;
        }

        footer {
            text-align: center;
            padding: 30px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }

        /* Light Theme */
        :root[data-theme="light"] body {
            background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
            color: #1a1a2e;
        }

        :root[data-theme="light"] header {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(0, 0, 0, 0.1);
        }

        :root[data-theme="light"] .nav-links a {
            color: rgba(0, 0, 0, 0.6);
        }

        :root[data-theme="light"] .nav-links a:hover,
        :root[data-theme="light"] .nav-links a.active {
            color: #1a1a2e;
            background: rgba(0, 0, 0, 0.1);
        }

        :root[data-theme="light"] .theme-toggle {
            background: rgba(0, 0, 0, 0.1);
            border-color: rgba(0, 0, 0, 0.2);
            color: #1a1a2e;
        }

        :root[data-theme="light"] .calc-panel {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(0, 0, 0, 0.1);
        }

        :root[data-theme="light"] .calc-tab {
            background: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.2);
            color: #1a1a2e;
        }

        :root[data-theme="light"] .input-field {
            background: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.2);
            color: #1a1a2e;
        }

        :root[data-theme="light"] .formula-box {
            background: rgba(0, 0, 0, 0.05);
        }

        :root[data-theme="light"] .formula-text {
            color: rgba(0, 0, 0, 0.8);
        }

        :root[data-theme="light"] .info-card {
            background: rgba(0, 0, 0, 0.05);
        }

        :root[data-theme="light"] .info-card p {
            color: rgba(0, 0, 0, 0.7);
        }

        :root[data-theme="light"] footer {
            color: rgba(0, 0, 0, 0.5);
        }

        /* Save Analysis Button */
        .save-analysis-btn {
            width: 100%;
            margin-top: 20px;
            padding: 14px 24px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .save-analysis-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .save-analysis-btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
            transform: none;
        }

        /* Saved Analyses Section */
        .saved-section {
            margin-top: 60px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .saved-section h2 {
            margin-bottom: 25px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .saved-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .saved-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .saved-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .saved-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .saved-card-symbol {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .saved-card-method {
            font-size: 0.75rem;
            padding: 4px 10px;
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
            border-radius: 12px;
        }

        .saved-card-values {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .saved-value-item {
            text-align: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .saved-value-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 5px;
        }

        .saved-value-num {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .saved-value-num.positive { color: #4ade80; }
        .saved-value-num.negative { color: #f87171; }

        .saved-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .saved-card-date {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .saved-card-actions {
            display: flex;
            gap: 8px;
        }

        .saved-action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .saved-action-btn.portfolio {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: #000;
        }

        .saved-action-btn.delete {
            background: rgba(248, 113, 113, 0.2);
            color: #f87171;
        }

        .saved-action-btn:hover {
            transform: scale(1.05);
        }

        .empty-saved {
            text-align: center;
            padding: 40px;
            color: rgba(255, 255, 255, 0.5);
        }

        .empty-saved-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 16px 24px;
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: #000;
            border-radius: 12px;
            font-weight: 600;
            box-shadow: 0 10px 30px rgba(74, 222, 128, 0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        :root[data-theme="light"] .saved-section {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(0, 0, 0, 0.1);
        }

        :root[data-theme="light"] .saved-card {
            background: #fff;
            border-color: rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        :root[data-theme="light"] .saved-value-item {
            background: rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">ğŸ§® ë‚´ì¬ê°€ì¹˜ ê³„ì‚°ê¸°</div>
            <nav class="nav-links">
                <a href="index.html">ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤</a>
                <a href="battle.html">ğŸ¤– AI ëŒ€ê²°</a>
                <a href="screener.html">ğŸ” ìŠ¤í¬ë¦¬ë„ˆ</a>
                <a href="ideas.html">ğŸ’¡ ì•„ì´ë””ì–´</a>
                <a href="history.html">ğŸ“œ ê±°ë˜ë‚´ì—­</a>
                <a href="manage.html">âš™ï¸ ê´€ë¦¬</a>
                <a href="guide.html">ğŸ“– ê°€ì´ë“œ</a>
                <a href="quiz.html">ğŸ§  í€´ì¦ˆ</a>
                <a href="glossary.html">ğŸ“š ìš©ì–´ì§‘</a>
                <a href="calculator.html" class="active">ğŸ§® ê³„ì‚°ê¸°</a>
                <a href="badges.html">ğŸ† ë°°ì§€</a>
                <a href="curriculum.html">ğŸ¯ ì»¤ë¦¬í˜ëŸ¼</a>
            </nav>
            <div class="header-buttons">
                <button class="theme-toggle" onclick="toggleTheme()" title="í…Œë§ˆ ì „í™˜">
                    <span id="themeIcon">â˜€ï¸</span>
                </button>
            </div>
        </div>
    </header>

    <main>
        <div class="page-header">
            <h1 class="page-title">ğŸ§® ë‚´ì¬ê°€ì¹˜ ê³„ì‚°ê¸°</h1>
            <p class="page-subtitle">ê°€ì¹˜íˆ¬ì ëŒ€ê°€ë“¤ì˜ ê³µì‹ìœ¼ë¡œ ì£¼ì‹ì˜ ì ì • ê°€ì¹˜ë¥¼ ê³„ì‚°í•˜ì„¸ìš”</p>
        </div>

        <div class="calculator-tabs">
            <button class="calc-tab active" onclick="showCalculator('dcf')">
                <span class="calc-tab-icon">ğŸ’°</span>
                <span class="calc-tab-name">DCF ëª¨ë¸</span>
                <span class="calc-tab-author">í˜„ê¸ˆíë¦„í• ì¸</span>
            </button>
            <button class="calc-tab" onclick="showCalculator('graham')">
                <span class="calc-tab-icon">ğŸ“•</span>
                <span class="calc-tab-name">ê·¸ë ˆì´ì—„ ê³µì‹</span>
                <span class="calc-tab-author">Benjamin Graham</span>
            </button>
            <button class="calc-tab" onclick="showCalculator('peg')">
                <span class="calc-tab-icon">ğŸ“ˆ</span>
                <span class="calc-tab-name">PEG ë°¸ë¥˜ì—ì´ì…˜</span>
                <span class="calc-tab-author">Peter Lynch</span>
            </button>
            <button class="calc-tab" onclick="showCalculator('ddm')">
                <span class="calc-tab-icon">ğŸ’µ</span>
                <span class="calc-tab-name">ë°°ë‹¹í• ì¸ëª¨ë¸</span>
                <span class="calc-tab-author">Gordon Growth</span>
            </button>
        </div>

        <!-- DCF Calculator -->
        <div id="dcf-calc" class="calculator-container">
            <div class="calc-panel">
                <h2 class="panel-title">ğŸ’° DCF í˜„ê¸ˆíë¦„í• ì¸ëª¨ë¸</h2>

                <div class="input-group">
                    <label class="input-label">
                        ì¢…ëª©ëª… / ì‹¬ë³¼
                        <span class="hint">ë¶„ì„í•  ì¢…ëª© (ì˜ˆ: ì‚¼ì„±ì „ì, AAPL)</span>
                    </label>
                    <input type="text" class="input-field" id="dcf-symbol" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì" value="">
                </div>

                <div class="input-group">
                    <label class="input-label">
                        í˜„ì¬ ì‰ì—¬í˜„ê¸ˆíë¦„ (FCF)
                        <span class="hint">ìµœê·¼ ì—°ê°„ FCF (ì–µì› ë˜ëŠ” ë°±ë§Œë‹¬ëŸ¬)</span>
                    </label>
                    <input type="number" class="input-field" id="dcf-fcf" placeholder="ì˜ˆ: 1000" value="1000">
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label">
                            ì„±ì¥ë¥  (%)
                            <span class="hint">í–¥í›„ 5ë…„ ì˜ˆìƒ ì„±ì¥ë¥ </span>
                        </label>
                        <input type="number" class="input-field" id="dcf-growth" placeholder="ì˜ˆ: 15" value="15">
                    </div>
                    <div class="input-group">
                        <label class="input-label">
                            ì˜êµ¬ ì„±ì¥ë¥  (%)
                            <span class="hint">5ë…„ ì´í›„ ì¥ê¸° ì„±ì¥ë¥ </span>
                        </label>
                        <input type="number" class="input-field" id="dcf-terminal-growth" placeholder="ì˜ˆ: 2" value="2">
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label">
                            í• ì¸ìœ¨ (%)
                            <span class="hint">WACC ë˜ëŠ” ìš”êµ¬ìˆ˜ìµë¥ </span>
                        </label>
                        <input type="number" class="input-field" id="dcf-discount" placeholder="ì˜ˆ: 10" value="10">
                    </div>
                    <div class="input-group">
                        <label class="input-label">
                            ë°œí–‰ì£¼ì‹ìˆ˜ (ë°±ë§Œì£¼)
                            <span class="hint">ì´ ë°œí–‰ ì£¼ì‹ ìˆ˜</span>
                        </label>
                        <input type="number" class="input-field" id="dcf-shares" placeholder="ì˜ˆ: 100" value="100">
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">
                        í˜„ì¬ ì£¼ê°€
                        <span class="hint">ë¹„êµë¥¼ ìœ„í•œ í˜„ì¬ ì‹œì¥ ê°€ê²©</span>
                    </label>
                    <input type="number" class="input-field" id="dcf-price" placeholder="ì˜ˆ: 50000" value="50000">
                </div>

                <button class="calculate-btn" onclick="calculateDCF()">ğŸ“Š ë‚´ì¬ê°€ì¹˜ ê³„ì‚°</button>

                <div class="formula-box">
                    <div class="formula-title">ğŸ“ DCF ê³µì‹</div>
                    <div class="formula-text">
                        ë‚´ì¬ê°€ì¹˜ = Î£(FCF Ã— (1+g)â¿ / (1+r)â¿) + í„°ë¯¸ë„ê°€ì¹˜<br>
                        í„°ë¯¸ë„ê°€ì¹˜ = FCFâ‚… Ã— (1+gâˆ) / (r - gâˆ)
                    </div>
                </div>
            </div>

            <div class="calc-panel">
                <h2 class="panel-title">ğŸ“Š ê³„ì‚° ê²°ê³¼</h2>
                <div id="dcf-result" class="result-panel">
                    <div class="result-title">ì£¼ë‹¹ ë‚´ì¬ê°€ì¹˜</div>
                    <div class="result-value">-</div>
                    <div class="result-comparison">
                        <div class="comparison-item">
                            <div class="comparison-label">í˜„ì¬ ì£¼ê°€</div>
                            <div class="comparison-value" id="dcf-current-price">-</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-label">ê´´ë¦¬ìœ¨</div>
                            <div class="comparison-value" id="dcf-margin">-</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-label">íˆ¬ì íŒë‹¨</div>
                            <div class="comparison-value" id="dcf-verdict">-</div>
                        </div>
                    </div>
                    <button class="save-analysis-btn" onclick="saveAnalysis('dcf')" id="dcf-save-btn" style="display: none;">
                        ğŸ’¾ ë¶„ì„ ì €ì¥í•˜ê¸°
                    </button>
                </div>

                <div class="info-card">
                    <h4>ğŸ’¡ DCF ëª¨ë¸ ì´í•´í•˜ê¸°</h4>
                    <p>
                        DCF(Discounted Cash Flow)ëŠ” ê¸°ì—…ì´ ë¯¸ë˜ì— ì°½ì¶œí•  í˜„ê¸ˆíë¦„ì„ í˜„ì¬ ê°€ì¹˜ë¡œ í• ì¸í•˜ì—¬
                        ê¸°ì—…ì˜ ë‚´ì¬ê°€ì¹˜ë¥¼ ê³„ì‚°í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ì›ŒëŸ° ë²„í•ì´ ê°€ì¥ ì„ í˜¸í•˜ëŠ” ê°€ì¹˜í‰ê°€ ë°©ë²•ìœ¼ë¡œ,
                        "ê¸°ì—…ì˜ ê°€ì¹˜ëŠ” ë‚¨ì€ ìˆ˜ëª… ë™ì•ˆ ì°½ì¶œí•  í˜„ê¸ˆì˜ í• ì¸ëœ í˜„ì¬ ê°€ì¹˜"ë¼ê³  ì •ì˜í•©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>

        <!-- Graham Calculator -->
        <div id="graham-calc" class="calculator-container hidden">
            <div class="calc-panel">
                <h2 class="panel-title">ğŸ“• ê·¸ë ˆì´ì—„ ë‚´ì¬ê°€ì¹˜ ê³µì‹</h2>

                <div class="input-group">
                    <label class="input-label">
                        ì¢…ëª©ëª… / ì‹¬ë³¼
                        <span class="hint">ë¶„ì„í•  ì¢…ëª© (ì˜ˆ: ì‚¼ì„±ì „ì, AAPL)</span>
                    </label>
                    <input type="text" class="input-field" id="graham-symbol" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì" value="">
                </div>

                <div class="input-group">
                    <label class="input-label">
                        ì£¼ë‹¹ìˆœì´ìµ (EPS)
                        <span class="hint">ìµœê·¼ 12ê°œì›” ê¸°ì¤€</span>
                    </label>
                    <input type="number" class="input-field" id="graham-eps" placeholder="ì˜ˆ: 5000" value="5000">
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label">
                            ì˜ˆìƒ ì„±ì¥ë¥  (%)
                            <span class="hint">í–¥í›„ 7-10ë…„ ì—°í‰ê·  ì„±ì¥ë¥ </span>
                        </label>
                        <input type="number" class="input-field" id="graham-growth" placeholder="ì˜ˆ: 10" value="10">
                    </div>
                    <div class="input-group">
                        <label class="input-label">
                            AAA ì±„ê¶Œ ìˆ˜ìµë¥  (%)
                            <span class="hint">í˜„ì¬ ìš°ëŸ‰ íšŒì‚¬ì±„ ê¸ˆë¦¬</span>
                        </label>
                        <input type="number" class="input-field" id="graham-bond" placeholder="ì˜ˆ: 4.4" value="4.4">
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">
                        í˜„ì¬ ì£¼ê°€
                        <span class="hint">ë¹„êµë¥¼ ìœ„í•œ í˜„ì¬ ì‹œì¥ ê°€ê²©</span>
                    </label>
                    <input type="number" class="input-field" id="graham-price" placeholder="ì˜ˆ: 80000" value="80000">
                </div>

                <button class="calculate-btn" onclick="calculateGraham()">ğŸ“Š ë‚´ì¬ê°€ì¹˜ ê³„ì‚°</button>

                <div class="formula-box">
                    <div class="formula-title">ğŸ“ ê·¸ë ˆì´ì—„ ê³µì‹ (ìˆ˜ì •íŒ)</div>
                    <div class="formula-text">
                        V = EPS Ã— (8.5 + 2g) Ã— 4.4 / Y<br><br>
                        V = ë‚´ì¬ê°€ì¹˜<br>
                        EPS = ì£¼ë‹¹ìˆœì´ìµ<br>
                        g = 7-10ë…„ ì˜ˆìƒ ì„±ì¥ë¥ <br>
                        8.5 = ì„±ì¥ë¥  0%ì¼ ë•Œ ì ì • PER<br>
                        4.4 = 1962ë…„ AAA ì±„ê¶Œ ìˆ˜ìµë¥ <br>
                        Y = í˜„ì¬ AAA ì±„ê¶Œ ìˆ˜ìµë¥ 
                    </div>
                </div>
            </div>

            <div class="calc-panel">
                <h2 class="panel-title">ğŸ“Š ê³„ì‚° ê²°ê³¼</h2>
                <div id="graham-result" class="result-panel">
                    <div class="result-title">ê·¸ë ˆì´ì—„ ë‚´ì¬ê°€ì¹˜</div>
                    <div class="result-value">-</div>
                    <div class="result-comparison">
                        <div class="comparison-item">
                            <div class="comparison-label">í˜„ì¬ ì£¼ê°€</div>
                            <div class="comparison-value" id="graham-current-price">-</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-label">ì•ˆì „ë§ˆì§„</div>
                            <div class="comparison-value" id="graham-margin">-</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-label">íˆ¬ì íŒë‹¨</div>
                            <div class="comparison-value" id="graham-verdict">-</div>
                        </div>
                    </div>
                    <button class="save-analysis-btn" onclick="saveAnalysis('graham')" id="graham-save-btn" style="display: none;">
                        ğŸ’¾ ë¶„ì„ ì €ì¥í•˜ê¸°
                    </button>
                </div>

                <div class="info-card">
                    <h4>ğŸ’¡ ê·¸ë ˆì´ì—„ ê³µì‹ ì´í•´í•˜ê¸°</h4>
                    <p>
                        ë²¤ì €ë¯¼ ê·¸ë ˆì´ì—„ì´ ã€Ší˜„ëª…í•œ íˆ¬ììã€‹ì—ì„œ ì œì‹œí•œ ë‚´ì¬ê°€ì¹˜ ê³µì‹ì…ë‹ˆë‹¤.
                        ì„±ì¥ë¥ ê³¼ ì´ìµì„ ê¸°ë°˜ìœ¼ë¡œ ì ì • PERì„ ê³„ì‚°í•˜ê³ , ê¸ˆë¦¬ í™˜ê²½ì„ ë°˜ì˜í•©ë‹ˆë‹¤.
                        ê·¸ë ˆì´ì—„ì€ ë‚´ì¬ê°€ì¹˜ ëŒ€ë¹„ ìµœì†Œ 33% í• ì¸ëœ ê°€ê²©(ì•ˆì „ë§ˆì§„)ì—ì„œ ë§¤ìˆ˜í•  ê²ƒì„ ê¶Œì¥í–ˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>

        <!-- PEG Calculator -->
        <div id="peg-calc" class="calculator-container hidden">
            <div class="calc-panel">
                <h2 class="panel-title">ğŸ“ˆ í”¼í„° ë¦°ì¹˜ PEG ë°¸ë¥˜ì—ì´ì…˜</h2>

                <div class="input-group">
                    <label class="input-label">
                        ì¢…ëª©ëª… / ì‹¬ë³¼
                        <span class="hint">ë¶„ì„í•  ì¢…ëª© (ì˜ˆ: ì‚¼ì„±ì „ì, AAPL)</span>
                    </label>
                    <input type="text" class="input-field" id="peg-symbol" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì" value="">
                </div>

                <div class="input-group">
                    <label class="input-label">
                        í˜„ì¬ ì£¼ê°€
                        <span class="hint">í˜„ì¬ ì‹œì¥ ê°€ê²©</span>
                    </label>
                    <input type="number" class="input-field" id="peg-price" placeholder="ì˜ˆ: 100000" value="100000">
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label">
                            ì£¼ë‹¹ìˆœì´ìµ (EPS)
                            <span class="hint">ìµœê·¼ 12ê°œì›” ê¸°ì¤€</span>
                        </label>
                        <input type="number" class="input-field" id="peg-eps" placeholder="ì˜ˆ: 5000" value="5000">
                    </div>
                    <div class="input-group">
                        <label class="input-label">
                            ì´ìµ ì„±ì¥ë¥  (%)
                            <span class="hint">í–¥í›„ ì˜ˆìƒ ì—°ê°„ ì„±ì¥ë¥ </span>
                        </label>
                        <input type="number" class="input-field" id="peg-growth" placeholder="ì˜ˆ: 20" value="20">
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">
                        ë°°ë‹¹ìˆ˜ìµë¥  (%) - ì„ íƒì‚¬í•­
                        <span class="hint">ë°°ë‹¹ ì§€ê¸‰ ì‹œ ì…ë ¥ (PEGY ê³„ì‚°)</span>
                    </label>
                    <input type="number" class="input-field" id="peg-dividend" placeholder="ì˜ˆ: 2" value="0">
                </div>

                <button class="calculate-btn" onclick="calculatePEG()">ğŸ“Š PEG ê³„ì‚°</button>

                <div class="formula-box">
                    <div class="formula-title">ğŸ“ PEG ê³µì‹</div>
                    <div class="formula-text">
                        PER = ì£¼ê°€ / EPS<br>
                        PEG = PER / ì„±ì¥ë¥ <br>
                        PEGY = PER / (ì„±ì¥ë¥  + ë°°ë‹¹ìˆ˜ìµë¥ )<br><br>
                        PEG < 1: ì €í‰ê°€ (ë§¤ë ¥ì )<br>
                        PEG = 1: ì ì •ê°€<br>
                        PEG > 1: ê³ í‰ê°€
                    </div>
                </div>
            </div>

            <div class="calc-panel">
                <h2 class="panel-title">ğŸ“Š ê³„ì‚° ê²°ê³¼</h2>
                <div id="peg-result" class="result-panel">
                    <div class="result-title">PEG ë¹„ìœ¨</div>
                    <div class="result-value">-</div>
                    <div class="result-comparison">
                        <div class="comparison-item">
                            <div class="comparison-label">í˜„ì¬ PER</div>
                            <div class="comparison-value" id="peg-per">-</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-label">ì ì • ì£¼ê°€</div>
                            <div class="comparison-value" id="peg-fair-price">-</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-label">íˆ¬ì íŒë‹¨</div>
                            <div class="comparison-value" id="peg-verdict">-</div>
                        </div>
                    </div>
                    <button class="save-analysis-btn" onclick="saveAnalysis('peg')" id="peg-save-btn" style="display: none;">
                        ğŸ’¾ ë¶„ì„ ì €ì¥í•˜ê¸°
                    </button>
                </div>

                <div class="info-card">
                    <h4>ğŸ’¡ PEG ì´í•´í•˜ê¸°</h4>
                    <p>
                        í”¼í„° ë¦°ì¹˜ê°€ ã€Šì „ì„¤ë¡œ ë– ë‚˜ëŠ” ì›”ê°€ì˜ ì˜ì›…ã€‹ì—ì„œ ì†Œê°œí•œ ë°¸ë¥˜ì—ì´ì…˜ ë°©ë²•ì…ë‹ˆë‹¤.
                        PERë§Œìœ¼ë¡œëŠ” ì„±ì¥ì£¼ë¥¼ ì œëŒ€ë¡œ í‰ê°€í•  ìˆ˜ ì—†ê¸°ì—, ì„±ì¥ë¥ ì„ ë°˜ì˜í•œ PEGë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
                        ë¦°ì¹˜ëŠ” PEG 1 ë¯¸ë§Œì˜ ì£¼ì‹ì„ "ì„±ì¥ë¥  ëŒ€ë¹„ ì €í‰ê°€ëœ ì£¼ì‹"ìœ¼ë¡œ ë³´ê³  ì„ í˜¸í–ˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>

        <!-- DDM Calculator -->
        <div id="ddm-calc" class="calculator-container hidden">
            <div class="calc-panel">
                <h2 class="panel-title">ğŸ’µ ë°°ë‹¹í• ì¸ëª¨ë¸ (DDM)</h2>

                <div class="input-group">
                    <label class="input-label">
                        ì¢…ëª©ëª… / ì‹¬ë³¼
                        <span class="hint">ë¶„ì„í•  ì¢…ëª© (ì˜ˆ: ì‚¼ì„±ì „ì, AAPL)</span>
                    </label>
                    <input type="text" class="input-field" id="ddm-symbol" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì" value="">
                </div>

                <div class="input-group">
                    <label class="input-label">
                        í˜„ì¬ ì£¼ë‹¹ë°°ë‹¹ê¸ˆ (DPS)
                        <span class="hint">ìµœê·¼ ì—°ê°„ ë°°ë‹¹ê¸ˆ</span>
                    </label>
                    <input type="number" class="input-field" id="ddm-dividend" placeholder="ì˜ˆ: 2000" value="2000">
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label">
                            ë°°ë‹¹ ì„±ì¥ë¥  (%)
                            <span class="hint">ì˜ˆìƒ ì—°ê°„ ë°°ë‹¹ ì„±ì¥ë¥ </span>
                        </label>
                        <input type="number" class="input-field" id="ddm-growth" placeholder="ì˜ˆ: 5" value="5">
                    </div>
                    <div class="input-group">
                        <label class="input-label">
                            ìš”êµ¬ìˆ˜ìµë¥  (%)
                            <span class="hint">íˆ¬ìì ê¸°ëŒ€ìˆ˜ìµë¥ </span>
                        </label>
                        <input type="number" class="input-field" id="ddm-required" placeholder="ì˜ˆ: 10" value="10">
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">
                        í˜„ì¬ ì£¼ê°€
                        <span class="hint">ë¹„êµë¥¼ ìœ„í•œ í˜„ì¬ ì‹œì¥ ê°€ê²©</span>
                    </label>
                    <input type="number" class="input-field" id="ddm-price" placeholder="ì˜ˆ: 50000" value="50000">
                </div>

                <button class="calculate-btn" onclick="calculateDDM()">ğŸ“Š ë‚´ì¬ê°€ì¹˜ ê³„ì‚°</button>

                <div class="formula-box">
                    <div class="formula-title">ğŸ“ ê³ ë“  ì„±ì¥ ëª¨ë¸</div>
                    <div class="formula-text">
                        V = Dâ‚ / (r - g)<br><br>
                        V = ì£¼ì‹ì˜ ë‚´ì¬ê°€ì¹˜<br>
                        Dâ‚ = ë‚´ë…„ ì˜ˆìƒ ë°°ë‹¹ê¸ˆ = Dâ‚€ Ã— (1 + g)<br>
                        r = ìš”êµ¬ìˆ˜ìµë¥ <br>
                        g = ë°°ë‹¹ ì„±ì¥ë¥  (r > g ì¡°ê±´)<br><br>
                        â€» ì„±ì¥ë¥ ì´ ìš”êµ¬ìˆ˜ìµë¥ ë³´ë‹¤ ë†’ìœ¼ë©´<br>
                        ëª¨ë¸ì´ ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                    </div>
                </div>
            </div>

            <div class="calc-panel">
                <h2 class="panel-title">ğŸ“Š ê³„ì‚° ê²°ê³¼</h2>
                <div id="ddm-result" class="result-panel">
                    <div class="result-title">ë°°ë‹¹í• ì¸ ë‚´ì¬ê°€ì¹˜</div>
                    <div class="result-value">-</div>
                    <div class="result-comparison">
                        <div class="comparison-item">
                            <div class="comparison-label">í˜„ì¬ ì£¼ê°€</div>
                            <div class="comparison-value" id="ddm-current-price">-</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-label">ë°°ë‹¹ìˆ˜ìµë¥ </div>
                            <div class="comparison-value" id="ddm-yield">-</div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-label">íˆ¬ì íŒë‹¨</div>
                            <div class="comparison-value" id="ddm-verdict">-</div>
                        </div>
                    </div>
                    <button class="save-analysis-btn" onclick="saveAnalysis('ddm')" id="ddm-save-btn" style="display: none;">
                        ğŸ’¾ ë¶„ì„ ì €ì¥í•˜ê¸°
                    </button>
                </div>

                <div class="info-card">
                    <h4>ğŸ’¡ ë°°ë‹¹í• ì¸ëª¨ë¸ ì´í•´í•˜ê¸°</h4>
                    <p>
                        ë°°ë‹¹í• ì¸ëª¨ë¸(DDM)ì€ ë¯¸ë˜ ë°°ë‹¹ê¸ˆì˜ í˜„ì¬ê°€ì¹˜ í•©ìœ¼ë¡œ ì£¼ì‹ ê°€ì¹˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
                        ì•ˆì •ì ìœ¼ë¡œ ë°°ë‹¹ì„ ì§€ê¸‰í•˜ê³  ì„±ì¥í•˜ëŠ” ê¸°ì—…(ìœ í‹¸ë¦¬í‹°, ê¸ˆìœµ, í•„ìˆ˜ì†Œë¹„ì¬)ì— ì í•©í•©ë‹ˆë‹¤.
                        ê³ ë“  ì„±ì¥ ëª¨ë¸ì€ ë°°ë‹¹ì´ ì¼ì •í•˜ê²Œ ì„±ì¥í•œë‹¤ëŠ” ê°€ì • í•˜ì— ê°„ë‹¨íˆ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>

        <!-- Saved Analyses Section -->
        <div class="saved-section" id="saved-section">
            <h2>ğŸ“‹ ì €ì¥ëœ ë¶„ì„ <span id="saved-count"></span></h2>
            <div class="saved-list" id="saved-list">
                <!-- Dynamically populated -->
            </div>
        </div>
    </main>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <footer>
        <p>ì£¼ì‹ í¬íŠ¸í´ë¦¬ì˜¤ ì§€ë‹ˆì–´ìŠ¤ - ë‚´ì¬ê°€ì¹˜ ê³„ì‚°ê¸°</p>
        <p style="margin-top: 10px; font-size: 0.8rem;">
            âš ï¸ ì´ ê³„ì‚°ê¸°ëŠ” êµìœ¡ ëª©ì ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤. ì‹¤ì œ íˆ¬ì ê²°ì • ì‹œì—ëŠ” ë” ê¹Šì€ ë¶„ì„ì´ í•„ìš”í•©ë‹ˆë‹¤.
        </p>
    </footer>

    <script>
        // í˜„ì¬ í™œì„±í™”ëœ ê³„ì‚°ê¸°
        let currentCalc = 'dcf';

        // ì €ì¥ëœ ë¶„ì„ ê´€ë¦¬
        const WATCHLIST_KEY = 'spg_watchlist';
        let lastCalculation = null; // ë§ˆì§€ë§‰ ê³„ì‚° ê²°ê³¼ ì €ì¥

        function showCalculator(calcType) {
            // íƒ­ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.calc-tab').forEach(tab => tab.classList.remove('active'));
            event.target.closest('.calc-tab').classList.add('active');

            // ê³„ì‚°ê¸° í‘œì‹œ
            document.querySelectorAll('.calculator-container').forEach(calc => calc.classList.add('hidden'));
            document.getElementById(calcType + '-calc').classList.remove('hidden');

            currentCalc = calcType;
        }

        function formatNumber(num) {
            return num.toLocaleString('ko-KR', { maximumFractionDigits: 0 });
        }

        function formatPercent(num) {
            return num.toFixed(1) + '%';
        }

        function getVerdict(margin) {
            if (margin > 30) return { text: 'ê°•ë ¥ ë§¤ìˆ˜', class: 'undervalued' };
            if (margin > 15) return { text: 'ë§¤ìˆ˜ ê²€í† ', class: 'undervalued' };
            if (margin > -10) return { text: 'ì ì •ê°€', class: 'fair' };
            if (margin > -25) return { text: 'ê³ í‰ê°€', class: 'overvalued' };
            return { text: 'ë§¤ë„ ê²€í† ', class: 'overvalued' };
        }

        // DCF ê³„ì‚°
        function calculateDCF() {
            const fcf = parseFloat(document.getElementById('dcf-fcf').value);
            const growth = parseFloat(document.getElementById('dcf-growth').value) / 100;
            const terminalGrowth = parseFloat(document.getElementById('dcf-terminal-growth').value) / 100;
            const discount = parseFloat(document.getElementById('dcf-discount').value) / 100;
            const shares = parseFloat(document.getElementById('dcf-shares').value);
            const currentPrice = parseFloat(document.getElementById('dcf-price').value);

            // 5ë…„ FCF í˜„ì¬ê°€ì¹˜ ê³„ì‚°
            let pvFCF = 0;
            let lastFCF = fcf;
            for (let i = 1; i <= 5; i++) {
                lastFCF = fcf * Math.pow(1 + growth, i);
                pvFCF += lastFCF / Math.pow(1 + discount, i);
            }

            // í„°ë¯¸ë„ ê°€ì¹˜
            const terminalValue = (lastFCF * (1 + terminalGrowth)) / (discount - terminalGrowth);
            const pvTerminal = terminalValue / Math.pow(1 + discount, 5);

            // ì´ ê¸°ì—…ê°€ì¹˜ ë° ì£¼ë‹¹ ê°€ì¹˜
            const enterpriseValue = pvFCF + pvTerminal;
            const intrinsicValue = enterpriseValue / shares;

            // ë§ˆì§„ ê³„ì‚°
            const margin = ((intrinsicValue - currentPrice) / currentPrice) * 100;
            const verdict = getVerdict(margin);

            // ê²°ê³¼ í‘œì‹œ
            document.querySelector('#dcf-result .result-value').textContent = formatNumber(intrinsicValue);
            document.getElementById('dcf-current-price').textContent = formatNumber(currentPrice);
            document.getElementById('dcf-margin').textContent = formatPercent(margin);
            document.getElementById('dcf-margin').className = 'comparison-value ' + verdict.class;
            document.getElementById('dcf-verdict').textContent = verdict.text;
            document.getElementById('dcf-verdict').className = 'comparison-value ' + verdict.class;

            // ê²°ê³¼ ì €ì¥ ë° ë²„íŠ¼ í‘œì‹œ
            lastCalculation = {
                method: 'dcf',
                intrinsicValue: intrinsicValue,
                currentPrice: currentPrice,
                margin: margin,
                verdict: verdict.text
            };
            document.getElementById('dcf-save-btn').style.display = 'block';

            // ë°°ì§€ íšë“
            if (typeof BadgeSystem !== 'undefined') {
                BadgeSystem.earnBadge('calculator_user');
            }
        }

        // ê·¸ë ˆì´ì—„ ê³µì‹ ê³„ì‚°
        function calculateGraham() {
            const eps = parseFloat(document.getElementById('graham-eps').value);
            const growth = parseFloat(document.getElementById('graham-growth').value);
            const bond = parseFloat(document.getElementById('graham-bond').value);
            const currentPrice = parseFloat(document.getElementById('graham-price').value);

            // ê·¸ë ˆì´ì—„ ê³µì‹: V = EPS Ã— (8.5 + 2g) Ã— 4.4 / Y
            const intrinsicValue = eps * (8.5 + 2 * growth) * (4.4 / bond);

            // ì•ˆì „ë§ˆì§„ ê³„ì‚°
            const margin = ((intrinsicValue - currentPrice) / currentPrice) * 100;
            const verdict = getVerdict(margin);

            // ê²°ê³¼ í‘œì‹œ
            document.querySelector('#graham-result .result-value').textContent = formatNumber(intrinsicValue);
            document.getElementById('graham-current-price').textContent = formatNumber(currentPrice);
            document.getElementById('graham-margin').textContent = formatPercent(margin);
            document.getElementById('graham-margin').className = 'comparison-value ' + verdict.class;
            document.getElementById('graham-verdict').textContent = verdict.text;
            document.getElementById('graham-verdict').className = 'comparison-value ' + verdict.class;

            // ê²°ê³¼ ì €ì¥ ë° ë²„íŠ¼ í‘œì‹œ
            lastCalculation = {
                method: 'graham',
                intrinsicValue: intrinsicValue,
                currentPrice: currentPrice,
                margin: margin,
                verdict: verdict.text
            };
            document.getElementById('graham-save-btn').style.display = 'block';

            // ë°°ì§€ íšë“
            if (typeof BadgeSystem !== 'undefined') {
                BadgeSystem.earnBadge('calculator_user');
                BadgeSystem.earnBadge('graham_disciple');
            }
        }

        // PEG ê³„ì‚°
        function calculatePEG() {
            const price = parseFloat(document.getElementById('peg-price').value);
            const eps = parseFloat(document.getElementById('peg-eps').value);
            const growth = parseFloat(document.getElementById('peg-growth').value);
            const dividend = parseFloat(document.getElementById('peg-dividend').value) || 0;

            const per = price / eps;
            const peg = per / growth;
            const pegy = dividend > 0 ? per / (growth + dividend) : peg;

            // ì ì • ì£¼ê°€ (PEG = 1 ê¸°ì¤€)
            const fairPrice = eps * growth;

            // íŒë‹¨
            let verdict;
            if (peg < 0.75) verdict = { text: 'ê°•ë ¥ ë§¤ìˆ˜', class: 'undervalued' };
            else if (peg < 1) verdict = { text: 'ì €í‰ê°€', class: 'undervalued' };
            else if (peg < 1.25) verdict = { text: 'ì ì •ê°€', class: 'fair' };
            else if (peg < 1.5) verdict = { text: 'ê³ í‰ê°€', class: 'overvalued' };
            else verdict = { text: 'ë§¤ìš° ê³ í‰ê°€', class: 'overvalued' };

            // ê²°ê³¼ í‘œì‹œ
            document.querySelector('#peg-result .result-value').textContent = peg.toFixed(2);
            document.getElementById('peg-per').textContent = per.toFixed(1);
            document.getElementById('peg-fair-price').textContent = formatNumber(fairPrice);
            document.getElementById('peg-verdict').textContent = verdict.text;
            document.getElementById('peg-verdict').className = 'comparison-value ' + verdict.class;

            // ê²°ê³¼ ì €ì¥ ë° ë²„íŠ¼ í‘œì‹œ
            const margin = ((fairPrice - price) / price) * 100;
            lastCalculation = {
                method: 'peg',
                intrinsicValue: fairPrice,
                currentPrice: price,
                margin: margin,
                verdict: verdict.text
            };
            document.getElementById('peg-save-btn').style.display = 'block';

            // ë°°ì§€ íšë“
            if (typeof BadgeSystem !== 'undefined') {
                BadgeSystem.earnBadge('calculator_user');
                BadgeSystem.earnBadge('lynch_learner');
            }
        }

        // DDM ê³„ì‚°
        function calculateDDM() {
            const dividend = parseFloat(document.getElementById('ddm-dividend').value);
            const growth = parseFloat(document.getElementById('ddm-growth').value) / 100;
            const required = parseFloat(document.getElementById('ddm-required').value) / 100;
            const currentPrice = parseFloat(document.getElementById('ddm-price').value);

            if (growth >= required) {
                document.querySelector('#ddm-result .result-value').textContent = 'ê³„ì‚° ë¶ˆê°€';
                document.getElementById('ddm-current-price').textContent = formatNumber(currentPrice);
                document.getElementById('ddm-yield').textContent = formatPercent((dividend / currentPrice) * 100);
                document.getElementById('ddm-verdict').textContent = 'ì„±ì¥ë¥  > í• ì¸ìœ¨';
                document.getElementById('ddm-verdict').className = 'comparison-value fair';
                return;
            }

            // ê³ ë“  ì„±ì¥ ëª¨ë¸: V = D1 / (r - g)
            const d1 = dividend * (1 + growth);
            const intrinsicValue = d1 / (required - growth);

            // ë§ˆì§„ ê³„ì‚°
            const margin = ((intrinsicValue - currentPrice) / currentPrice) * 100;
            const verdict = getVerdict(margin);
            const dividendYield = (dividend / currentPrice) * 100;

            // ê²°ê³¼ í‘œì‹œ
            document.querySelector('#ddm-result .result-value').textContent = formatNumber(intrinsicValue);
            document.getElementById('ddm-current-price').textContent = formatNumber(currentPrice);
            document.getElementById('ddm-yield').textContent = formatPercent(dividendYield);
            document.getElementById('ddm-verdict').textContent = verdict.text;
            document.getElementById('ddm-verdict').className = 'comparison-value ' + verdict.class;

            // ê²°ê³¼ ì €ì¥ ë° ë²„íŠ¼ í‘œì‹œ
            lastCalculation = {
                method: 'ddm',
                intrinsicValue: intrinsicValue,
                currentPrice: currentPrice,
                margin: margin,
                verdict: verdict.text
            };
            document.getElementById('ddm-save-btn').style.display = 'block';

            // ë°°ì§€ íšë“
            if (typeof BadgeSystem !== 'undefined') {
                BadgeSystem.earnBadge('calculator_user');
            }
        }

        // ========== ë¶„ì„ ì €ì¥ ê¸°ëŠ¥ ==========

        function getWatchlist() {
            try {
                return JSON.parse(localStorage.getItem(WATCHLIST_KEY)) || [];
            } catch (e) {
                console.warn('Watchlist load error:', e);
                return [];
            }
        }

        function saveWatchlist(list) {
            try {
                localStorage.setItem(WATCHLIST_KEY, JSON.stringify(list));
            } catch (e) {
                console.warn('Watchlist save error:', e);
            }
        }

        function saveAnalysis(method) {
            const symbolInput = document.getElementById(method + '-symbol');
            const symbol = symbolInput?.value?.trim();

            if (!symbol) {
                showToast('âš ï¸ ì¢…ëª©ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'warning');
                symbolInput?.focus();
                return;
            }

            if (!lastCalculation || lastCalculation.method !== method) {
                showToast('âš ï¸ ë¨¼ì € ê³„ì‚°ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”', 'warning');
                return;
            }

            const analysis = {
                id: Date.now(),
                symbol: symbol,
                method: method,
                methodName: getMethodName(method),
                intrinsicValue: lastCalculation.intrinsicValue,
                currentPrice: lastCalculation.currentPrice,
                margin: lastCalculation.margin,
                verdict: lastCalculation.verdict,
                date: new Date().toISOString()
            };

            const watchlist = getWatchlist();

            // ê°™ì€ ì¢…ëª©+ë°©ë²• ì¡°í•©ì´ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
            const existingIdx = watchlist.findIndex(
                w => w.symbol === symbol && w.method === method
            );

            if (existingIdx >= 0) {
                watchlist[existingIdx] = analysis;
                showToast('âœ… ë¶„ì„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
                watchlist.unshift(analysis);
                showToast('âœ… ë¶„ì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }

            saveWatchlist(watchlist);
            renderSavedList();

            // ë°°ì§€ íšë“
            if (typeof BadgeSystem !== 'undefined') {
                BadgeSystem.earnBadge('first_analysis');
                if (watchlist.length >= 5) {
                    BadgeSystem.earnBadge('analyst_junior');
                }
            }
        }

        function deleteAnalysis(id) {
            if (!confirm('ì´ ë¶„ì„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            const watchlist = getWatchlist().filter(w => w.id !== id);
            saveWatchlist(watchlist);
            renderSavedList();
            showToast('ğŸ—‘ï¸ ë¶„ì„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function goToPortfolio(symbol) {
            // í¬íŠ¸í´ë¦¬ì˜¤ í˜ì´ì§€ë¡œ ì´ë™í•˜ë©´ì„œ ê²€ìƒ‰ íŒŒë¼ë¯¸í„° ì „ë‹¬
            localStorage.setItem('spg_search_symbol', symbol);
            window.location.href = 'index.html';
        }

        function getMethodName(method) {
            const names = {
                dcf: 'DCF ëª¨ë¸',
                graham: 'ê·¸ë ˆì´ì—„',
                peg: 'PEG',
                ddm: 'DDM'
            };
            return names[method] || method;
        }

        function renderSavedList() {
            const watchlist = getWatchlist();
            const container = document.getElementById('saved-list');
            const countEl = document.getElementById('saved-count');
            const section = document.getElementById('saved-section');

            if (countEl) {
                countEl.textContent = watchlist.length > 0 ? `(${watchlist.length}ê°œ)` : '';
            }

            if (watchlist.length === 0) {
                container.innerHTML = `
                    <div class="empty-saved">
                        <div class="empty-saved-icon">ğŸ“Š</div>
                        <p>ì €ì¥ëœ ë¶„ì„ì´ ì—†ìŠµë‹ˆë‹¤</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">
                            ì¢…ëª©ì„ ë¶„ì„í•˜ê³  ì €ì¥í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
                        </p>
                    </div>
                `;
                return;
            }

            container.innerHTML = watchlist.map(item => {
                const marginClass = item.margin >= 0 ? 'positive' : 'negative';
                const date = new Date(item.date).toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });

                return `
                    <div class="saved-card">
                        <div class="saved-card-header">
                            <div class="saved-card-symbol">${item.symbol}</div>
                            <div class="saved-card-method">${item.methodName}</div>
                        </div>
                        <div class="saved-card-values">
                            <div class="saved-value-item">
                                <div class="saved-value-label">ë‚´ì¬ê°€ì¹˜</div>
                                <div class="saved-value-num">â‚©${formatNumber(item.intrinsicValue)}</div>
                            </div>
                            <div class="saved-value-item">
                                <div class="saved-value-label">í˜„ì¬ê°€</div>
                                <div class="saved-value-num">â‚©${formatNumber(item.currentPrice)}</div>
                            </div>
                            <div class="saved-value-item">
                                <div class="saved-value-label">ê´´ë¦¬ìœ¨</div>
                                <div class="saved-value-num ${marginClass}">${item.margin > 0 ? '+' : ''}${item.margin.toFixed(1)}%</div>
                            </div>
                            <div class="saved-value-item">
                                <div class="saved-value-label">íŒë‹¨</div>
                                <div class="saved-value-num">${item.verdict}</div>
                            </div>
                        </div>
                        <div class="saved-card-footer">
                            <div class="saved-card-date">${date}</div>
                            <div class="saved-card-actions">
                                <button class="saved-action-btn portfolio" onclick="goToPortfolio('${item.symbol}')" title="í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ ë³´ê¸°">
                                    ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤
                                </button>
                                <button class="saved-action-btn delete" onclick="deleteAnalysis(${item.id})" title="ì‚­ì œ">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = type === 'warning'
                ? 'linear-gradient(135deg, #f59e0b, #d97706)'
                : 'linear-gradient(135deg, #4ade80, #22c55e)';
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Theme Toggle
        const THEME_KEY = 'spg_theme';

        function initTheme() {
            const savedTheme = localStorage.getItem(THEME_KEY) || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeButton(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem(THEME_KEY, newTheme);
            updateThemeButton(newTheme);
        }

        function updateThemeButton(theme) {
            const icon = document.getElementById('themeIcon');
            if (icon) {
                icon.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            }
        }

        // ì´ˆê¸°í™”
        initTheme();
        renderSavedList();
        if (typeof BadgeSystem !== 'undefined') {
            BadgeSystem.init();
        }
    </script>
</body>
</html>
